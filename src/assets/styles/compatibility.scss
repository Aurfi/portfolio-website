// Cross-browser compatibility styles
@use 'variables' as *;

// CSS Reset for better cross-browser consistency
*,
*::before,
*::after {
  box-sizing: border-box;
}

// Fix for iOS Safari viewport units
html {
  // Use CSS custom properties for viewport units that work better on mobile
  --vh: 1vh;
  --vw: 1vw;

  @supports (-webkit-touch-callout: none) {
    // iOS Safari specific fixes
    --vh: 1vh;
    height: -webkit-fill-available;
  }
}

body {
  // Fix for iOS Safari bounce scrolling
  -webkit-overflow-scrolling: touch;

  // Prevent horizontal scroll on mobile
  overflow-x: hidden;

  // Fix for iOS Safari height issues
  min-height: 100vh;
  min-height: -webkit-fill-available;
}

// Fix for Safari flexbox bugs
.flex-container {
  display: flex;

  // Safari flexbox fix
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
}

// Grid fallbacks for older browsers
.grid-container {
  display: grid;

  // Fallback for IE11
  @supports not (display: grid) {
    display: flex;
    flex-wrap: wrap;

    .grid-item {
      flex: 1 1 auto;
      min-width: 300px;
    }
  }
}

// CSS Custom Properties fallbacks
:root {
  // Fallback colors for browsers that don't support CSS custom properties
  color: #333333;
  background-color: #ffffff;
}

// Fix for IE11 CSS Grid
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .grid-container {
    display: -ms-grid;
  }
}

// Smooth scrolling fallback
html {
  scroll-behavior: smooth;

  // Fallback for browsers that don't support scroll-behavior
  @supports not (scroll-behavior: smooth) {
    // JavaScript will handle smooth scrolling
  }
}

// Backdrop filter fallbacks
.backdrop-blur {
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  // Fallback for browsers that don't support backdrop-filter
  @supports not (backdrop-filter: blur(10px)) {
    background-color: rgba(255, 255, 255, 0.8);
  }

  @supports not (-webkit-backdrop-filter: blur(10px)) {
    background-color: rgba(255, 255, 255, 0.8);
  }
}

// Sticky positioning fallbacks
.sticky {
  position: sticky;
  position: -webkit-sticky;
  top: 0;

  // Fallback for browsers that don't support sticky
  @supports not (position: sticky) {
    position: fixed;
  }
}

// Object-fit fallbacks
.object-fit-cover {
  object-fit: cover;

  // Fallback for IE11
  @supports not (object-fit: cover) {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
}

// CSS Clip-path fallbacks
.clip-path {
  clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);

  // Fallback for browsers that don't support clip-path
  @supports not (clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%)) {
    &::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 15%;
      background: linear-gradient(to bottom right, transparent 49%, white 50%);
    }
  }
}

// Focus-visible polyfill support
.js-focus-visible :focus:not(.focus-visible) {
  outline: none;
}

// High contrast mode support
@media (prefers-contrast: high) {
  * {
    border-color: ButtonText !important;
  }

  .btn {
    border: 2px solid ButtonText !important;
  }

  a {
    text-decoration: underline !important;
  }
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

// Dark mode support for older browsers
@media (prefers-color-scheme: dark) {
  :root {
    color-scheme: dark;
  }
}

// Print styles
@media print {
  * {
    background: transparent !important;
    color: black !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }

  a,
  a:visited {
    text-decoration: underline;
  }

  a[href]:after {
    content: ' (' attr(href) ')';
  }

  .no-print {
    display: none !important;
  }

  .page-break {
    page-break-before: always;
  }
}

// Mobile-specific fixes
@media (max-width: 768px) {
  // Fix for iOS Safari 100vh issue
  .full-height {
    height: 100vh;
    height: -webkit-fill-available;
  }

  // Prevent zoom on input focus (iOS Safari)
  input,
  textarea,
  select {
    font-size: 16px;
  }

  // Fix for Android Chrome address bar
  .mobile-viewport-fix {
    min-height: 100vh;
    min-height: calc(var(--vh, 1vh) * 100);
  }
}

// Firefox-specific fixes
@-moz-document url-prefix() {
  // Firefox flexbox fixes
  .flex-container {
    min-height: 0;
  }

  // Firefox grid fixes
  .grid-container {
    min-height: 0;
  }
}

// Safari-specific fixes
@supports (-webkit-appearance: none) {
  // Safari button fixes
  button,
  input[type='button'],
  input[type='submit'] {
    -webkit-appearance: none;
    border-radius: 0;
  }

  // Safari input fixes
  input[type='search'] {
    -webkit-appearance: none;

    &::-webkit-search-decoration,
    &::-webkit-search-cancel-button {
      -webkit-appearance: none;
    }
  }
}

// Edge-specific fixes
@supports (-ms-ime-align: auto) {
  // Edge flexbox fixes
  .flex-container {
    min-height: 1px;
  }
}

// Chrome-specific fixes
@supports (-webkit-background-clip: text) {
  .gradient-text {
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
}

// Internet Explorer fixes (if still needed)
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  // IE11 flexbox fixes
  .flex-container {
    display: -ms-flexbox;
    -ms-flex-wrap: wrap;
  }

  .flex-item {
    -ms-flex: 1 1 auto;
  }

  // IE11 grid fixes
  .grid-container {
    display: -ms-grid;
  }
}

// Feature detection classes (added by JavaScript)
.no-webp .webp-image {
  background-image: url('fallback.jpg') !important;
}

.no-avif .avif-image {
  background-image: url('fallback.webp') !important;
}

.no-js {
  .js-only {
    display: none !important;
  }
}

// Touch device optimizations
@media (hover: none) and (pointer: coarse) {
  // Increase touch targets
  button,
  a,
  input,
  textarea,
  select {
    min-height: 44px;
    min-width: 44px;
  }

  // Remove hover effects on touch devices
  .hover-effect:hover {
    transform: none !important;
  }
}

// High DPI display optimizations
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .high-dpi-image {
    background-image: url('image@2x.jpg');
  }
}

// Landscape orientation fixes for mobile
@media (orientation: landscape) and (max-height: 500px) {
  .mobile-landscape-fix {
    height: auto;
    min-height: auto;
  }
}
